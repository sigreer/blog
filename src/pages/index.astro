---
import Layout from "../layouts/Layout.astro";
import directus from "../lib/directus";
import { readSingleton, readItems } from "@directus/sdk";
import TagCloud from "../components/TagCloud.astro";
import Introduction from "../components/Introduction.astro";
import DynamicKeyCards from "../components/DynamicKeyCards.astro";
import BlogListCards from "../components/BlogListCards.astro";
import BlogListLines from "../components/BlogListLines.astro";
import '../styles/custom.css';
const global = await directus.request(readSingleton("global"));
const posts = await directus.request(readItems("posts", {
  fields: ['*', { author: ['*'] }],
}));
const tagCounts = posts.reduce((acc, post) => {
  if (Array.isArray(post.tags)) {
    post.tags.forEach(tag => {
      acc[tag] = (acc[tag] || 0) + 1;
    });
  }
  return acc;
}, {});

---

<Layout title={global.title} description={global.description}>
  <Introduction />
  <DynamicKeyCards />
  <BlogListCards />
  <BlogListLines />
  <TagCloud tagCounts={tagCounts} />
</Layout>